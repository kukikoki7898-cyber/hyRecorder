<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìš°ë¦¬ë“¤ì˜ ë§í•˜ê¸° ì—°ìŠµ</title>
    <style>
        body {
            background-color: #FFFBEB; /* íŒŒìŠ¤í…”í†¤ í¬ë¦¼ìƒ‰ */
            font-family: 'Malgun Gothic', 'Apple SD Gothic Neo', sans-serif;
            color: #333;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        h1 {
            color: #4A4A4A;
            text-align: center;
            font-size: 2.2em;
            font-weight: 600;
        }

        .list-container {
            width: 100%;
            max-width: 700px;
            max-height: 70vh; 
            overflow-y: auto; 
            padding: 10px;
            background-color: rgba(255, 255, 255, 0.5);
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        /* ìŠ¤í¬ë¡¤ë°” ë””ìì¸ */
        .list-container::-webkit-scrollbar { width: 8px; }
        .list-container::-webkit-scrollbar-thumb { background-color: #D4D4D4; border-radius: 4px; }
        .list-container::-webkit-scrollbar-track { background-color: transparent; }

        .item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #FFFFFF;
            padding: 18px 25px;
            margin-bottom: 12px;
            border-radius: 12px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.08);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        .item:last-child { margin-bottom: 0; }

        .item-number {
            font-size: 1.4em;
            font-weight: bold;
            color: #555;
        }

        .buttons {
            display: flex;
            gap: 10px;
        }

        .btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 10px 15px;
            border: none;
            border-radius: 20px;
            font-size: 1em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            min-width: 110px; /* ë²„íŠ¼ í¬ê¸°ê°€ ë³€í•˜ì§€ ì•Šë„ë¡ ìµœì†Œ ë„ˆë¹„ ì§€ì • */
            justify-content: center;
        }
        
        /* ë¹„í™œì„±í™”ëœ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .btn:disabled {
            background-color: #E0E0E0; /* íšŒìƒ‰ */
            color: #9E9E9E;
            cursor: not-allowed;
            opacity: 0.7;
        }
        .btn:disabled:hover {
            transform: none; /* í˜¸ë²„ íš¨ê³¼ ì œê±° */
        }

        /* ë…¹ìŒí•˜ê¸° ë²„íŠ¼ (íŒŒìŠ¤í…” ê·¸ë¦°) */
        .btn-record {
            background-color: #C8E6C9;
            color: #256029;
        }
        .btn-record:not(:disabled):hover {
            background-color: #A5D6A7;
            transform: scale(1.05);
        }
        
        /* ë…¹ìŒ ì¤‘ ë²„íŠ¼ (íŒŒìŠ¤í…” ë ˆë“œ) */
        .btn-record.recording {
            background-color: #FFCDD2; /* ì—°í•œ ë¹¨ê°• */
            color: #B71C1C;
        }
        .btn-record.recording:not(:disabled):hover {
            background-color: #EF9A9A;
        }


        /* ì¬ìƒí•˜ê¸° ë²„íŠ¼ (íŒŒìŠ¤í…” ë¸”ë£¨) */
        .btn-play {
            background-color: #B3E5FC;
            color: #01579B;
        }
        .btn-play:not(:disabled):hover {
            background-color: #81D4FA;
            transform: scale(1.05);
        }

        /* ë‹¤ì‹œ ë…¹ìŒí•˜ê¸° ë²„íŠ¼ (íŒŒìŠ¤í…” ì˜ë¡œìš°) */
        .btn-rerecord {
            background-color: #FFECB3;
            color: #6D4C00;
        }
        .btn-rerecord:not(:disabled):hover {
            background-color: #FFE082;
            transform: scale(1.05);
        }
    </style>
</head>
<body>

    <h1>ğŸ™ï¸ ìš°ë¦¬ë“¤ì˜ ë§í•˜ê¸° ì—°ìŠµ</h1>
    <div class="list-container" id="list-container">
        </div>

    <script>
        // --- 1. ì „ì—­ ë³€ìˆ˜ ì„¤ì • ---

        let mediaRecorder; // MediaRecorder ì¸ìŠ¤í„´ìŠ¤
        let mediaStream;   // ë§ˆì´í¬ ìŠ¤íŠ¸ë¦¼
        let audioChunks = []; // ë…¹ìŒëœ ì˜¤ë””ì˜¤ ì²­í¬ ë°°ì—´
        let currentRecordingButton = null; // í˜„ì¬ ë…¹ìŒ ì¤‘ì¸ ë²„íŠ¼
        
        // ê° ë²ˆí˜¸ë³„ë¡œ ë…¹ìŒëœ ì˜¤ë””ì˜¤ Blobì„ ì €ì¥í•  Map
        const audioStore = new Map();

        // --- 2. í•µì‹¬ ê¸°ëŠ¥ í•¨ìˆ˜ ---

        /**
         * ë§ˆì´í¬ ê¶Œí•œì„ ìš”ì²­í•˜ê³  ìŠ¤íŠ¸ë¦¼ì„ ì¤€ë¹„í•©ë‹ˆë‹¤.
         */
        async function setupStream() {
            try {
                // í•œ ë²ˆë§Œ ìŠ¤íŠ¸ë¦¼ì„ ìš”ì²­í•©ë‹ˆë‹¤.
                if (!mediaStream) {
                    mediaStream = await navigator.mediaDevices.getUserMedia({ audio: true });
                }
            } catch (err) {
                console.error("ë§ˆì´í¬ ì ‘ê·¼ ì˜¤ë¥˜:", err);
                alert("ë§ˆì´í¬ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì„¤ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”.");
            }
        }

        /**
         * ë…¹ìŒ ì‹œì‘/ì¤‘ì§€ ì²˜ë¦¬ë¥¼ ë‹´ë‹¹í•˜ëŠ” í•¨ìˆ˜
         * @param {number} itemNumber - í•­ëª© ë²ˆí˜¸ (1~15)
         * @param {HTMLElement} recordBtn - í´ë¦­ëœ 'ë…¹ìŒ' ë²„íŠ¼
         * @param {HTMLElement} playBtn - í•´ë‹¹ í•­ëª©ì˜ 'ì¬ìƒ' ë²„íŠ¼
         * @param {HTMLElement} rerecordBtn - í•´ë‹¹ í•­ëª©ì˜ 'ë‹¤ì‹œ ë…¹ìŒ' ë²„íŠ¼
         */
        async function handleRecordClick(itemNumber, recordBtn, playBtn, rerecordBtn) {
            
            // ë‹¤ë¥¸ í•­ëª©ì´ ì´ë¯¸ ë…¹ìŒ ì¤‘ì¼ ë•Œ
            if (mediaRecorder && mediaRecorder.state === 'recording' && currentRecordingButton !== recordBtn) {
                alert("ë‹¤ë¥¸ í•­ëª©ì„ ë…¹ìŒ ì¤‘ì…ë‹ˆë‹¤. ë¨¼ì € ë…¹ìŒì„ ì¤‘ì§€í•´ì£¼ì„¸ìš”.");
                return;
            }

            // ë§ˆì´í¬ ìŠ¤íŠ¸ë¦¼ ì¤€ë¹„ (ìµœì´ˆ 1íšŒ)
            await setupStream();
            if (!mediaStream) return; // ì‚¬ìš©ìê°€ ê¶Œí•œì„ ê±°ë¶€í•œ ê²½ìš°

            // --- ë…¹ìŒ ì¤‘ì§€ ---
            if (mediaRecorder && mediaRecorder.state === 'recording') {
                mediaRecorder.stop();
                
            // --- ë…¹ìŒ ì‹œì‘ ---
            } else {
                audioChunks = []; // ì²­í¬ ì´ˆê¸°í™”
                mediaRecorder = new MediaRecorder(mediaStream);

                // (1) ë…¹ìŒ ë°ì´í„°ê°€ ë“¤ì–´ì˜¬ ë•Œ
                mediaRecorder.ondataavailable = event => {
                    audioChunks.push(event.data);
                };

                // (2) ë…¹ìŒì´ ì¤‘ì§€ë  ë•Œ
                mediaRecorder.onstop = () => {
                    // ë…¹ìŒëœ ë°ì´í„°ë¥¼ Blobìœ¼ë¡œ í•©ì¹¨
                    const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                    
                    // í•´ë‹¹ ë²ˆí˜¸ì— Blob ì €ì¥
                    audioStore.set(itemNumber, audioBlob);

                    // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
                    recordBtn.innerHTML = 'ğŸ¤ <span>ë…¹ìŒí•˜ê¸°</span>';
                    recordBtn.classList.remove('recording');
                    playBtn.disabled = false; // ì¬ìƒ ë²„íŠ¼ í™œì„±í™”
                    rerecordBtn.disabled = false; // ë‹¤ì‹œ ë…¹ìŒ ë²„íŠ¼ í™œì„±í™”
                    
                    currentRecordingButton = null;
                };

                // ë…¹ìŒ ì‹œì‘
                mediaRecorder.start();
                
                // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸ (ë…¹ìŒ ì¤‘)
                recordBtn.innerHTML = 'ğŸ”´ <span>ë…¹ìŒ ì¤‘ì§€</span>';
                recordBtn.classList.add('recording');
                playBtn.disabled = true; // ë…¹ìŒ ì¤‘ì—ëŠ” ì¬ìƒ ë¹„í™œì„±í™”
                rerecordBtn.disabled = true; // ë…¹ìŒ ì¤‘ì—ëŠ” ë‹¤ì‹œ ë…¹ìŒ ë¹„í™œì„±í™”
                
                currentRecordingButton = recordBtn;
            }
        }

        /**
         * ì¬ìƒ ë²„íŠ¼ í´ë¦­ ì‹œ ì˜¤ë””ì˜¤ë¥¼ ì¬ìƒí•˜ëŠ” í•¨ìˆ˜
         * @param {number} itemNumber - í•­ëª© ë²ˆí˜¸ (1~15)
         */
        function handlePlayClick(itemNumber) {
            const audioBlob = audioStore.get(itemNumber);
            
            if (audioBlob) {
                // Blobì„ ì¬ìƒ ê°€ëŠ¥í•œ URLë¡œ ë³€í™˜
                const audioUrl = URL.createObjectURL(audioBlob);
                const audio = new Audio(audioUrl);
                
                audio.play();

                // ì¬ìƒì´ ëë‚˜ë©´ ë©”ëª¨ë¦¬ í™•ë³´ë¥¼ ìœ„í•´ URL í•´ì œ
                audio.onended = () => {
                    URL.revokeObjectURL(audioUrl);
                };
            } else {
                alert("ì¬ìƒí•  ë…¹ìŒ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ë…¹ìŒì„ í•´ì£¼ì„¸ìš”.");
            }
        }

        // --- 3. í™”ë©´ êµ¬ì„± (HTML ë™ì  ìƒì„±) ---

        const listContainer = document.getElementById('list-container');

        // ë¸Œë¼ìš°ì €ê°€ MediaRecorderë¥¼ ì§€ì›í•˜ëŠ”ì§€ í™•ì¸
        if (!navigator.mediaDevices || !window.MediaRecorder) {
            listContainer.innerHTML = '<p style="color: red; text-align: center;">ì£„ì†¡í•©ë‹ˆë‹¤. ì´ ë¸Œë¼ìš°ì €ëŠ” ìŒì„± ë…¹ìŒì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>';
        } else {
            // 1ë²ˆë¶€í„° 15ë²ˆê¹Œì§€ í•­ëª© ìƒì„±
            for (let i = 1; i <= 15; i++) {
                
                // (ì´ ë³€ìˆ˜ ì„ ì–¸ì´ ì¤‘ìš”í•©ë‹ˆë‹¤. í´ë¡œì € ë¬¸ì œ ë°©ì§€)
                const itemNumber = i; 

                const item = document.createElement('div');
                item.className = 'item';

                const itemNumberSpan = document.createElement('span');
                itemNumberSpan.className = 'item-number';
                itemNumberSpan.textContent = `${itemNumber}ë²ˆ`;

                const buttons = document.createElement('div');
                buttons.className = 'buttons';

                // 'ë…¹ìŒí•˜ê¸°' ë²„íŠ¼
                const recordButton = document.createElement('button');
                recordButton.className = 'btn btn-record';
                recordButton.innerHTML = 'ğŸ¤ <span>ë…¹ìŒí•˜ê¸°</span>';

                // 'ì¬ìƒí•˜ê¸°' ë²„íŠ¼
                const playButton = document.createElement('button');
                playButton.className = 'btn btn-play';
                playButton.innerHTML = 'â–¶ï¸ <span>ì¬ìƒí•˜ê¸°</span>';
                playButton.disabled = true; // ì²˜ìŒì—ëŠ” ë¹„í™œì„±í™”

                // 'ë‹¤ì‹œ ë…¹ìŒí•˜ê¸°' ë²„íŠ¼
                const rerecordButton = document.createElement('button');
                rerecordButton.className = 'btn btn-rerecord';
                rerecordButton.innerHTML = 'ğŸ”„ <span>ë‹¤ì‹œ ë…¹ìŒ</span>';
                rerecordButton.disabled = true; // ì²˜ìŒì—ëŠ” ë¹„í™œì„±í™”

                // --- 4. ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì—°ê²° ---

                // 'ë…¹ìŒí•˜ê¸°' ë²„íŠ¼ í´ë¦­ ì‹œ
                recordButton.onclick = () => {
                    handleRecordClick(itemNumber, recordButton, playButton, rerecordButton);
                };

                // 'ë‹¤ì‹œ ë…¹ìŒí•˜ê¸°' ë²„íŠ¼ í´ë¦­ ì‹œ (ë…¹ìŒí•˜ê¸°ì™€ ë™ì¼í•œ ê¸°ëŠ¥ ìˆ˜í–‰)
                rerecordButton.onclick = () => {
                    handleRecordClick(itemNumber, recordButton, playButton, rerecordButton);
                };

                // 'ì¬ìƒí•˜ê¸°' ë²„íŠ¼ í´ë¦­ ì‹œ
                playButton.onclick = () => {
                    handlePlayClick(itemNumber);
                };

                // HTMLì— ìš”ì†Œë“¤ ì¶”ê°€
                buttons.appendChild(recordButton);
                buttons.appendChild(playButton);
                buttons.appendChild(rerecordButton);

                item.appendChild(itemNumberSpan);
                item.appendChild(buttons);

                listContainer.appendChild(item);
            }
        }
    </script>

</body>
</html>